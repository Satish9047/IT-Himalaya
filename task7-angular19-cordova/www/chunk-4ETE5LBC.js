import{M as u,R as l,c as a,cb as f,qb as d,rb as h,ua as g}from"./chunk-GM3PGS4F.js";function m(){return p(new Date)}function S(){let r=new Date;return r.setDate(r.getDate()+1),p(r)}function p(r){let s=r.getFullYear(),e=String(r.getMonth()),t=String(r.getDate()),n=String(r.getHours()),o=String(r.getMinutes()),c=String(r.getSeconds());return`${s}/${e}/${t}-${n}:${o}:${c}`}var i=class{id;description;createdAt;dueDate;completed;completedAt;userId;constructor(s,e,t,n,o=!1,c=null){this.id=s,this.description=e,this.completed=o,this.dueDate=n,this.createdAt=t,this.completedAt=c}MarkTaskToCompleted(){this.completed=!0,this.completedAt=m()}};var k=class r{constructor(s,e){this.localforageService=s;this.userService=e;this.user=this.userService.user,f(()=>{this.currentUser=this.user(),console.log("Current User:",this.currentUser)})}_tasks=g([]);tasks=this._tasks.asReadonly();user;currentUser;loadTasks(){return a(this,null,function*(){if(this.currentUser===null)return[];try{let e=yield this.localforageService.getStoreInstance(this.currentUser).getItem("tasks");if(e){let t=[];return e.forEach(n=>{let o=new i(n.id,n.description,n.createdAt,n.dueDate,n.completed,n.completedAt);t.push(o)}),this._tasks.set(t),e}else return[]}catch{return[]}})}addTask(s){return a(this,null,function*(){if(!this.user())return!1;this._tasks.update(e=>[...e,s]);try{if(this.currentUser){let t=yield this.localforageService.getStoreInstance(this.currentUser).setItem("tasks",this._tasks());return t?(console.log("addTask in localforage",t),!0):!1}else return!1}catch{return!1}})}markTaskAsCompleted(s){return a(this,null,function*(){this._tasks.update(e=>e.map(t=>(t.id===s&&(t.MarkTaskToCompleted(),this.currentUser&&this.localforageService.getStoreInstance(this.currentUser).setItem("tasks",e).then(o=>{o&&console.log("update Task in localforage",o)}).catch(o=>{console.error("Error updating tasks in localforage",o)})),t)))})}deleteTask(s){return a(this,null,function*(){this._tasks.update(e=>e.filter(t=>t.id!==s));try{if(this.currentUser){let t=yield this.localforageService.getStoreInstance(this.currentUser).setItem("tasks",this._tasks());return t?(console.log("delete Task in localforage",t),!0):!1}else return!1}catch(e){return console.error("Error deleting tasks in localforage",e),!1}})}clearTasks(){this._tasks.set([])}static \u0275fac=function(e){return new(e||r)(l(d),l(h))};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})};export{m as a,S as b,i as c,k as d};
